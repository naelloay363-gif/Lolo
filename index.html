<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©</title>
<style>
  body {
    font-family: 'Cairo', sans-serif;
    background-color: #e8f2fb;
    margin: 0;
    padding: 0;
    color: #003366;
    direction: rtl;
  }
  header {
    background-color: #1e88e5;
    color: white;
    text-align: center;
    padding: 15px;
    font-size: 22px;
    font-weight: bold;
  }
  nav {
    display: flex;
    justify-content: space-around;
    background-color: #1565c0;
    color: white;
    padding: 10px;
  }
  nav button {
    background: none;
    border: none;
    color: white;
    font-size: 16px;
    cursor: pointer;
  }
  nav button:hover {
    text-decoration: underline;
  }
  section {
    padding: 15px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    border: 1px solid #bbb;
    padding: 8px;
    text-align: center;
  }
  th {
    background-color: #1976d2;
    color: white;
  }
  .btn {
    padding: 6px 10px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
  }
  .btn-primary {
    background-color: #2196f3;
    color: white;
  }
  .btn-danger {
    background-color: #e53935;
    color: white;
  }
  .btn-secondary {
    background-color: #90caf9;
    color: #003366;
  }
  input, select {
    padding: 5px;
    margin: 4px;
    border-radius: 5px;
    border: 1px solid #999;
  }
  h2 {
    color: #0d47a1;
    margin-top: 15px;
  }
</style>
</head>
<body>
  <header>ğŸ“˜ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©</header>

  <nav>
    <button onclick="showSection('sales')">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</button>
    <button onclick="showSection('expenses')">Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</button>
    <button onclick="showSection('suppliers')">Ø§Ù„ØªØ¬Ø§Ø±</button>
    <button onclick="showSection('loans')">Ø§Ù„Ø³Ù„Ù</button>
    <button onclick="showSection('owner')">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ</button>
    <button onclick="showSection('reports')">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
  </nav>

  <section id="sales" class="page">
    <h2>ğŸ“¦ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h2>
    <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨ÙŠØ¹:</label><input type="number" id="saleAmount">
    <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</label>
    <select id="saleType">
      <option value="cash">ÙƒØ§Ø´</option>
      <option value="bank">Ø¨Ù†Ùƒ</option>
    </select>
    <button class="btn btn-primary" onclick="addSale()">Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ¹</button>
    <div id="salesTable"></div>
  </section>
  <section id="expenses" class="page" style="display:none">
    <h2>ğŸ’¸ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h2>
    <label>Ø§Ù„Ù‚ÙŠÙ…Ø©:</label><input type="number" id="expAmount">
    <label>Ø§Ù„Ø¨ÙŠØ§Ù†:</label><input type="text" id="expDesc">
    <button class="btn btn-primary" onclick="addExpense()">Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ</button>
    <div id="expensesTable"></div>
  </section>

  <section id="suppliers" class="page" style="display:none">
    <h2>ğŸ§¾ Ø§Ù„ØªØ¬Ø§Ø±</h2>
    <label>Ø§Ø³Ù… Ø§Ù„ØªØ§Ø¬Ø±:</label><input type="text" id="supName">
    <label>ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©:</label><input type="number" id="supInvoice">
    <button class="btn btn-primary" onclick="addSupplierInvoice()">Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø©</button>
    <br>
    <label>Ø³Ø¯Ø§Ø¯ Ù„ØªØ§Ø¬Ø±:</label><input type="text" id="supPayName">
    <label>Ø§Ù„Ù…Ø¨Ù„Øº:</label><input type="number" id="supPayAmount">
    <select id="supPaySource">
      <option value="store">ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„</option>
      <option value="owner">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ</option>
      <option value="bank">Ø§Ù„Ø¨Ù†Ùƒ</option>
    </select>
    <button class="btn btn-secondary" onclick="paySupplier()">Ø³Ø¯Ø§Ø¯</button>
    <div id="supWrap"></div>
  </section>

  <section id="loans" class="page" style="display:none">
    <h2>ğŸ¤ Ø§Ù„Ø³Ù„Ù</h2>
    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ù„Ù:</label><input type="text" id="loanPerson">
    <label>Ø§Ù„Ù…Ø¨Ù„Øº:</label><input type="number" id="loanAmount">
    <button class="btn btn-primary" onclick="addLoan()">Ø¥Ø¶Ø§ÙØ© Ø³Ù„ÙØ©</button>
    <br>
    <label>Ø³Ø¯Ø§Ø¯ Ø³Ù„ÙØ©:</label><input type="text" id="loanPayPerson">
    <label>Ø§Ù„Ù…Ø¨Ù„Øº:</label><input type="number" id="loanPayAmount">
    <select id="loanPaySource">
      <option value="store">ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„</option>
      <option value="owner">ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ</option>
    </select>
    <button class="btn btn-secondary" onclick="payLoan()">Ø³Ø¯Ø§Ø¯</button>
    <div id="loansWrap"></div>
  </section>

  <section id="owner" class="page" style="display:none">
    <h2>ğŸ¦ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ</h2>
    <div id="ownerBalance"></div>
    <button class="btn btn-secondary" onclick="showOwnerDetails()">ÙƒØ´Ù ÙÙˆØ±ÙŠ</button>
    <div id="ownerDetails"></div>
  </section>

  <section id="reports" class="page" style="display:none">
    <h2>ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h2>
    <label>Ù…Ù† ØªØ§Ø±ÙŠØ®:</label><input type="date" id="repFrom">
    <label>Ø¥Ù„Ù‰:</label><input type="date" id="repTo">
    <button class="btn btn-primary" onclick="generateReport()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
    <button class="btn btn-secondary" onclick="exportPDF()">Ø·Ø¨Ø§Ø¹Ø© PDF</button>
    <div id="reportsWrap"></div>
  </section>

  <script>
  // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
  function showSection(id) {
    document.querySelectorAll('.page').forEach(sec => sec.style.display='none');
    document.getElementById(id).style.display='block';
  }

  function uid() {
    return 'id-' + Math.random().toString(36).substr(2,9);
  }

  function todayISO() {
    return new Date().toISOString().split('T')[0];
  }
  // ================= Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª =================
  function getStoreData() {
    return JSON.parse(localStorage.getItem('storeData') || '{"sales":[],"expenses":[],"cashFromLoans":0}');
  }
  function saveStoreData(data) {
    localStorage.setItem('storeData', JSON.stringify(data));
  }

  function addSale() {
    const amount = parseFloat(document.getElementById('saleAmount').value||0);
    const type = document.getElementById('saleType').value;
    if (!amount) return alert('Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø¨ÙŠØ¹ ØµØ­ÙŠØ­Ø©');
    const data = getStoreData();
    data.sales.push({id:uid(), date:todayISO(), amount, type});
    saveStoreData(data);
    document.getElementById('saleAmount').value='';
    renderSales();
  }

  function renderSales() {
    const data = getStoreData();
    if(!data.sales.length){document.getElementById('salesTable').innerHTML='<div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª</div>';return;}
    let html='<table><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th></tr>';
    data.sales.forEach(s=>{html+=`<tr><td>${s.date}</td><td>${s.amount}</td><td>${s.type==='cash'?'ÙƒØ§Ø´':'Ø¨Ù†Ùƒ'}</td></tr>`;});
    html+='</table>';
    document.getElementById('salesTable').innerHTML=html;
  }

  // ================= Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ =================
  function addExpense() {
    const amt=parseFloat(document.getElementById('expAmount').value||0);
    const desc=document.getElementById('expDesc').value.trim();
    if(!amt) return alert('Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­');
    const d=getStoreData();
    d.expenses.push({id:uid(), date:todayISO(), amount:amt, desc});
    saveStoreData(d);
    document.getElementById('expAmount').value='';
    document.getElementById('expDesc').value='';
    renderExpenses();
  }

  function renderExpenses() {
    const d=getStoreData();
    if(!d.expenses.length){document.getElementById('expensesTable').innerHTML='<div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ§Ø±ÙŠÙ</div>';return;}
    let html='<table><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ÙˆØµÙ</th></tr>';
    d.expenses.forEach(e=>{html+=`<tr><td>${e.date}</td><td>${e.amount}</td><td>${e.desc}</td></tr>`;});
    html+='</table>';
    document.getElementById('expensesTable').innerHTML=html;
  }

  // ================= Ø§Ù„ØªØ¬Ø§Ø± =================
  function getSuppliers(){return JSON.parse(localStorage.getItem('suppliers')||'{"people":{}}');}
  function saveSuppliers(x){localStorage.setItem('suppliers',JSON.stringify(x));}

  function addSupplierInvoice(){
    const n=(document.getElementById('supName').value||'').trim();
    const v=parseFloat(document.getElementById('supInvoice').value||0);
    if(!n||!v) return alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ÙˆÙ‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø©');
    const S=getSuppliers(); if(!S.people[n]) S.people[n]={balance:0,history:[]};
    S.people[n].balance+=v;
    S.people[n].history.push({id:uid(),date:todayISO(),type:'invoice',amount:v,note:'ÙØ§ØªÙˆØ±Ø© Ù…Ø´ØªØ±ÙŠØ§Øª'});
    saveSuppliers(S);
    renderSuppliers();
  }

  function paySupplier(){
    const n=(document.getElementById('supPayName').value||'').trim();
    const v=parseFloat(document.getElementById('supPayAmount').value||0);
    const src=document.getElementById('supPaySource').value;
    if(!n||!v) return alert('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    const S=getSuppliers(); if(!S.people[n]) S.people[n]={balance:0,history:[]};
    S.people[n].balance-=v;
    S.people[n].history.push({id:uid(),date:todayISO(),type:'pay',amount:v,source:src});
    saveSuppliers(S);

    // Ø®ØµÙ… Ù…Ù† ÙƒØ§Ø´ Ø£Ùˆ Ø§Ù„Ù…Ø§Ù„Ùƒ
    if(src==='store'){
      const d=getStoreData(); d.expenses.push({id:uid(),date:todayISO(),amount:v,desc:`Ø¯ÙØ¹Ø© ØªØ§Ø¬Ø± (${n})`});
      saveStoreData(d);
    } else if(src==='owner'){
      const O=getOwner(); O.ledger.push({id:uid(),date:todayISO(),type:'out',amount:v,note:`Ø¯ÙØ¹Ø© ØªØ§Ø¬Ø± (${n})`}); saveOwner(O);
    }
    renderSuppliers(); renderOwner(); renderExpenses();
  }

  function renderSuppliers(){
    const S=getSuppliers(), names=Object.keys(S.people);
    if(!names.length){document.getElementById('supWrap').innerHTML='<div>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ¬Ø§Ø±</div>';return;}
    let html='<table><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>';
    names.forEach(n=>{
      html+=`<tr><td>${n}</td><td>${S.people[n].balance}</td>
      <td><button class="btn btn-danger" onclick="deleteSupplier('${n}')">Ø­Ø°Ù</button></td></tr>`;
    });
    html+='</table>';
    document.getElementById('supWrap').innerHTML=html;
  }

  function deleteSupplier(name){
    if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø¬Ø± ÙˆØ¬Ù…ÙŠØ¹ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙ‡ØŸ')) return;
    const S=getSuppliers(); delete S.people[name]; saveSuppliers(S); renderSuppliers();
  }

  // ================= Ø§Ù„Ø³Ù„Ù =================
  function getLoans(){return JSON.parse(localStorage.getItem('loans')||'{"people":{}}');}
  function saveLoans(x){localStorage.setItem('loans',JSON.stringify(x));}

  function addLoan(){
    const n=(document.getElementById('loanPerson').value||'').trim();
    const v=parseFloat(document.getElementById('loanAmount').value||0);
    if(!n||!v) return alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ÙˆÙ…Ø¨Ù„Øº');
    const L=getLoans(); if(!L.people[n]) L.people[n]={balance:0,history:[]};
    L.people[n].balance+=v;
    L.people[n].history.push({id:uid(),date:todayISO(),type:'in',amount:v,note:'Ø³Ù„ÙØ© Ù„Ù„Ù…Ø­Ù„'});
    saveLoans(L);
    const d=getStoreData(); d.cashFromLoans+=v; saveStoreData(d);
    renderLoans(); renderExpenses(); renderSales();
  }

  function payLoan(){
    const n=(document.getElementById('loanPayPerson').value||'').trim();
    const v=parseFloat(document.getElementById('loanPayAmount').value||0);
    const src=document.getElementById('loanPaySource').value;
    if(!n||!v) return alert('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    const L=getLoans(); if(!L.people[n]) L.people[n]={balance:0,history:[]};
    L.people[n].balance-=v;
    L.people[n].history.push({id:uid(),date:todayISO(),type:'out',amount:v,source:src});
    saveLoans(L);
    if(src==='store'){
      const d=getStoreData(); d.expenses.push({id:uid(),date:todayISO(),amount:v,desc:`Ø³Ø¯Ø§Ø¯ Ø³Ù„ÙØ© (${n})`});
      d.cashFromLoans-=v; saveStoreData(d);
    } else {
      const O=getOwner(); O.ledger.push({id:uid(),date:todayISO(),type:'out',amount:v,note:`Ø³Ø¯Ø§Ø¯ Ø³Ù„ÙØ© (${n})`}); saveOwner(O);
    }
    renderLoans(); renderExpenses();
  }

  function renderLoans(){
    const L=getLoans(), names=Object.keys(L.people);
    if(!names.length){document.getElementById('loansWrap').innerHTML='<div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ù„Ù</div>';return;}
    let html='<table><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>';
    names.forEach(n=>{
      html+=`<tr><td>${n}</td><td>${L.people[n].balance}</td>
      <td><button class="btn btn-danger" onclick="deleteLoan('${n}')">Ø­Ø°Ù</button></td></tr>`;
    });
    html+='</table>';
    document.getElementById('loansWrap').innerHTML=html;
  }

  function deleteLoan(name){
    if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³Ù„Ù ÙˆØ¬Ù…ÙŠØ¹ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙ‡ØŸ')) return;
    const L=getLoans(); delete L.people[name]; saveLoans(L); renderLoans();
  }

  // ================= ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ =================
  function getOwner(){return JSON.parse(localStorage.getItem('owner')||'{"ledger":[]}');}
  function saveOwner(x){localStorage.setItem('owner',JSON.stringify(x));}
  function renderOwner(){
    const O=getOwner(); let bal=0;
    O.ledger.forEach(l=>{if(l.type==='in')bal+=l.amount;else bal-=l.amount;});
    document.getElementById('ownerBalance').innerHTML='Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø§Ù„Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: '+bal.toFixed(2);
  }
  function showOwnerDetails(){
    const O=getOwner(); let html='<table><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ù…Ù„Ø§Ø­Ø¸Ø©</th></tr>';
    O.ledger.slice(-10).reverse().forEach(l=>{html+=`<tr><td>${l.date}</td><td>${l.type==='in'?'Ø¥ÙŠØ¯Ø§Ø¹':'Ø³Ø­Ø¨'}</td><td>${l.amount}</td><td>${l.note||''}</td></tr>`;});
    html+='</table>';
    document.getElementById('ownerDetails').innerHTML=html;
  }
// ================= Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± =================
  function generateReport(){
    const from=document.getElementById('repFrom').value;
    const to=document.getElementById('repTo').value;
    const d=getStoreData();

    let salesTotal=d.sales.filter(s=>!from||(s.date>=from&&s.date<=to))
      .reduce((a,b)=>a+b.amount,0);
    let expTotal=d.expenses.filter(s=>!from||(s.date>=from&&s.date<=to))
      .reduce((a,b)=>a+b.amount,0);
    let loanCash=d.cashFromLoans||0;
    let netCash=(salesTotal+loanCash)-expTotal;

    let html=`<h3>ØªÙ‚Ø±ÙŠØ± Ù…Ù† ${from||'Ø¨Ø¯Ø§ÙŠØ©'} Ø¥Ù„Ù‰ ${to||'Ø§Ù„ÙŠÙˆÙ…'}</h3>`;
    html+=`<table><tr><th>Ø§Ù„Ø¨Ù†Ø¯</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr>`;
    html+=`<tr><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙƒØ§Ø´</td><td>${salesTotal}</td></tr>`;
    html+=`<tr><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</td><td>${expTotal}</td></tr>`;
    html+=`<tr><td>ğŸ’µ Ø§Ù„ÙƒØ§Ø´ Ù…Ù† Ø§Ù„Ø³ÙÙ„Ù</td><td>${loanCash}</td></tr>`;
    html+=`<tr><th>ØµØ§ÙÙŠ Ø§Ù„ÙƒØ§Ø´</th><th>${netCash}</th></tr></table>`;
    document.getElementById('reportsWrap').innerHTML=html;
  }

  // ============= Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© PDF =============
  function exportPDF(){
    const element=document.getElementById('reportsWrap');
    const opt={
      margin:0.5,
      filename:'ØªÙ‚Ø±ÙŠØ±_Ù†Ø¸Ø§Ù…_Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©.pdf',
      image:{type:'jpeg',quality:0.98},
      html2canvas:{scale:2},
      jsPDF:{unit:'in',format:'a4',orientation:'portrait'}
    };
    html2pdf().from(element).set(opt).save();
  }

  // ============= Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ =============
  window.onload=function(){
    renderSales();
    renderExpenses();
    renderSuppliers();
    renderLoans();
    renderOwner();
  }
  </script>

  <!-- Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</body>
</html>
