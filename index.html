<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© â€” Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</title>
<meta name="theme-color" content="#2b7bff"/>

<!-- PWA (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) -->
<link rel="manifest" href="./manifest.webmanifest"/>

<style>
:root{
  --blue:#2b7bff; --blue-soft:#eaf3ff; --line:#e5e7eb; --card:#fff;
  --danger:#dc3545; --ok:#16a34a; --muted:#64748b
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;font-family:Tajawal,Arial,Helvetica,sans-serif;background:var(--blue-soft);color:#0f172a}
header{position:sticky;top:0;z-index:10;background:var(--blue);color:#fff;padding:12px 14px;box-shadow:0 2px 10px rgba(0,0,0,.08)}
header h1{margin:0;font-size:18px}
header .sub{opacity:.95;font-size:13px}
header .owner-badge{margin-top:6px;font-size:14px;color:#eaf5ff;background:rgba(255,255,255,.12);display:inline-block;padding:6px 10px;border-radius:10px}
main{padding:12px;max-width:1150px;margin:auto;padding-bottom:160px}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin:10px 0;box-shadow:0 1px 6px rgba(0,0,0,.04)}
h3{margin:6px 0 10px;color:#0d47a1}
.row{display:flex;flex-wrap:wrap;gap:10px}
.col{flex:1;min-width:220px}
label{font-size:13px;color:#111}
input,select,textarea,button{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:12px;font-size:16px;background:#fff}
button{border:none;cursor:pointer}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;border-radius:12px;padding:10px 14px;font-size:14px}
.btn-primary{background:var(--blue);color:#fff}
.btn-outline{background:#fff;border:1px solid var(--line);color:#111}
.btn-danger{background:var(--danger);color:#fff}
.btn-ok{background:var(--ok);color:#fff}
.hint{font-size:12px;color:var(--muted)}
.list .item{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:8px 0;border-bottom:1px dashed var(--line)}
.list .item:last-child{border-bottom:none}
.list .meta{flex:1}
.kpi{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
.kpi .box{background:#f3f7ff;border:1px solid #e3ecff;border-radius:12px;padding:10px;text-align:center}
.kpi .box b{display:block;font-size:16px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid var(--line);padding:8px;text-align:center;font-size:14px}
th{background:#f8fbff}
.tabs{position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:1px solid var(--line);display:flex}
.tab{flex:1}
.tab button{width:100%;background:#fff;border:none;padding:12px 0}
.tab.active{background:#f0f6ff}
.separator{height:1px;background:var(--line);margin:8px 0}
.subtle{background:#f9fbff;border:1px solid #eef2ff;border-radius:12px;padding:10px;margin-top:8px}
.badge{display:inline-block;padding:.15rem .5rem;border-radius:999px;background:#eef2ff;border:1px solid #e5e7eb;font-size:12px}
@media print{
  header,nav.tabs,.print-hide{display:none!important}
  body{background:#fff}
  .card{box-shadow:none;border:none;padding:0;margin:0}
  .page{page-break-after:always;margin-bottom:30px}
}
</style>
</head>
<body>
<header class="print-hide">
  <h1>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©</h1>
  <div class="sub">Ø§Ù„Ù…Ø§Ù„Ùƒ: <b>Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø£Ø¨Ùˆ Ø¹ÙˆØ¶</b></div>
  <div class="owner-badge">Ø±ØµÙŠØ¯ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ: <b id="ownerBalanceVal">0</b></div>
</header>

<main>

  <!-- Ø´Ø±ÙŠØ· Ø³Ø±ÙŠØ¹ -->
  <div class="card print-hide">
    <div class="row">
      <div class="col">
        <label>Ø§Ù„Ù…Ø­Ù„</label>
        <select id="storeSelect">
          <option value="store1">Ø±ÙˆØ§Ù† Ø¨ÙŠØ¨ÙŠ</option>
          <option value="store2">Ø¬Ù†ØªÙ„ Ø¨ÙŠØ¨ÙŠ Ø¹Ø¨ÙˆØ¯</option>
          <option value="store3">Ø¨Ø³Ø·Ø©</option>
        </select>
      </div>
      <div class="col">
        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…</label>
        <input type="date" id="todayInput"/>
      </div>
      <div class="col">
        <label>&nbsp;</label>
        <button class="btn btn-primary" id="btnSettleSingle">ØªØ³ÙˆÙŠØ© Ø§Ù„ÙŠÙˆÙ… (Ø§Ù„Ù…Ø­Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ)</button>
      </div>
      <div class="col">
        <label>&nbsp;</label>
        <button class="btn btn-ok" id="btnSettleAll">ØªØ³ÙˆÙŠØ© Ù…Ø¬Ù…Ù‘Ø¹Ø© Ø§Ù„ÙŠÙˆÙ… (ÙƒÙ„ Ø§Ù„Ù…Ø­Ù„Ø§Øª)</button>
      </div>
    </div>
    <div class="hint">
      ØªØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª â€” Ø§Ù„ØªØ³ÙˆÙŠØ© Ø§Ù„Ù…Ø¬Ù…Ù‘Ø¹Ø© ØªÙØ¸Ù‡Ø± ÙƒØ§Ø´/Ø¨Ù†Ùƒ Ù„ÙƒÙ„ Ù…Ø­Ù„ ÙˆØªÙØ³Ø¬Ù‘Ù„ ØªØ­ØµÙŠÙ„ Ø§Ù„Ù…Ø§Ù„Ùƒ Ø¨Ù…ÙÙ„Ø§Ø­Ø¸Ø© ÙˆØ§Ø¶Ø­Ø©.
    </div>
  </div>

  <!-- Ø¥Ø¯Ø®Ø§Ù„ -->
  <section class="card" data-tab="input">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
    <div class="row">
      <div class="col"><input type="number" id="saleAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº"></div>
      <div class="col">
        <select id="saleType">
          <option value="ÙƒØ§Ø´">ÙƒØ§Ø´</option>
          <option value="Ø¨Ù†Ùƒ">Ø¨Ù†Ùƒ</option>
        </select>
      </div>
      <div class="col"><input type="text" id="saleNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±ÙŠ/Ø§Ù„ØµÙ†Ù/Ø¬ÙˆØ§Ù„)"></div>
      <div class="col"><button class="btn btn-ok" id="btnAddSale">â• Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ¹</button></div>
    </div>
    <div id="recentSales" class="list"></div>

    <h3 style="margin-top:18px">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ (Ù…Ù† ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„)</h3>
    <div class="row">
      <div class="col"><input type="text" id="expenseDesc" placeholder="ÙˆØµÙ Ø§Ù„Ù…ØµØ±ÙˆÙ"></div>
      <div class="col"><input type="number" id="expenseAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº"></div>
      <div class="col"><input type="text" id="expenseNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></div>
      <div class="col">
        <select id="expenseBenefType">
          <option value="">â€” Ø¬Ù‡Ø© Ù…Ø³ØªÙÙŠØ¯Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) â€”</option>
          <option value="supplier">Ø³Ø¯Ø§Ø¯ Ù„ØªØ§Ø¬Ø±</option>
          <option value="loan">Ø³Ø¯Ø§Ø¯ Ù„Ù…Ø³Ù„Ù</option>
        </select>
      </div>
      <div class="col">
        <input type="text" id="expenseBenefName" list="benefList" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… ÙˆØ³ÙŠØ¸Ù‡Ø± Ø§Ù‚ØªØ±Ø§Ø­">
        <datalist id="benefList"></datalist>
      </div>
      <div class="col"><button class="btn btn-ok" id="addExpenseBtn">â• Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ</button></div>
    </div>
    <div id="recentExpenses" class="list"></div>
  </section>

  <!-- ÙŠÙˆÙ…ÙŠ -->
  <section class="card" data-tab="daily">
    <h3>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
    <div class="row print-hide">
      <div class="col"><label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input type="date" id="r_date"></div>
      <div class="col"><label>Ø§Ù„Ù…Ø­Ù„</label>
        <select id="r_store">
          <option value="store1">Ø±ÙˆØ§Ù† Ø¨ÙŠØ¨ÙŠ</option>
          <option value="store2">Ø¬Ù†ØªÙ„ Ø¨ÙŠØ¨ÙŠ Ø¹Ø¨ÙˆØ¯</option>
          <option value="store3">Ø¨Ø³Ø·Ø©</option>
        </select>
      </div>
      <div class="col"><label>&nbsp;</label><button class="btn btn-primary" id="btnDaily">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button></div>
      <div class="col"><label>&nbsp;</label><button class="btn btn-outline" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© PDF</button></div>
    </div>
    <div id="dailyWrap"></div>
  </section>

  <!-- ÙØªØ±Ø© / Ù…Ø¬Ù…Ù‘Ø¹ -->
  <section class="card" data-tab="range">
    <h3>ØªÙ‚Ø±ÙŠØ± ÙØªØ±Ø© / Ù…Ø¬Ù…Ù‘Ø¹</h3>
    <div class="row print-hide">
      <div class="col"><label>Ù…Ù†</label><input type="date" id="f_from"></div>
      <div class="col"><label>Ø¥Ù„Ù‰</label><input type="date" id="f_to"></div>
      <div class="col"><label>Ø§Ù„Ù†Ù…Ø·</label><select id="f_mode"><option value="per">Ù…Ù†ÙØµÙ„ Ù„ÙƒÙ„ Ù…Ø­Ù„</option><option value="all">Ù…Ø¬Ù…Ù‘Ø¹ Ù„Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„Ø«Ù„Ø§Ø«Ø©</option></select></div>
      <div class="col"><label>&nbsp;</label><button class="btn btn-primary" id="btnRange">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button></div>
      <div class="col"><label>&nbsp;</label><button class="btn btn-outline" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© PDF</button></div>
    </div>
    <div id="rangeWrap"></div>
  </section>

  <!-- Ø§Ù„Ø³Ù„Ù -->
  <section class="card" data-tab="loans">
    <h3>Ø§Ù„Ø³ÙÙ„Ù (ÙƒØ§Ø´ ÙÙ‚Ø·)</h3>
    <div class="row">
      <div class="col"><input type="text" id="loanPerson" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙØ³Ù„Ù"></div>
      <div class="col"><input type="number" id="loanAmount" placeholder="Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ù„ÙØ© (+)"></div>
      <div class="col"><button class="btn btn-ok" id="btnAddLoan">â• Ø¥Ø¶Ø§ÙØ© Ø³Ù„ÙØ© (ÙŠØ²ÙŠØ¯ ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§)</button></div>
    </div>
    <div class="row">
      <div class="col"><input type="text" id="loanPayPerson" list="loanList" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ù„Ù„Ø³Ø¯Ø§Ø¯"></div>
      <datalist id="loanList"></datalist>
      <div class="col"><input type="number" id="loanPayAmount" placeholder="Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯ (âˆ’)"></div>
      <div class="col">
        <select id="loanPaySource">
          <option value="store">Ù…Ù† ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„</option>
          <option value="owner">Ù…Ù† ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ</option>
        </select>
      </div>
      <div class="col"><button class="btn btn-primary" id="btnPayLoan">ğŸ’¸ ØªØ³Ø¬ÙŠÙ„ Ø³Ø¯Ø§Ø¯</button></div>
    </div>

    <div class="row print-hide" style="margin-top:8px">
      <div class="col"><input type="text" id="loanStmtName" list="loanList" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ù„Ù Ù„ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨"></div>
      <div class="col"><input type="date" id="loanStmtFrom"></div>
      <div class="col"><input type="date" id="loanStmtTo"></div>
      <div class="col"><button class="btn btn-outline" id="btnLoanStmt">ğŸ“„ Ø¹Ø±Ø¶ ÙƒØ´Ù Ø§Ù„Ù…Ø³Ù„Ù</button></div>
      <div class="col"><button class="btn btn-outline" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© PDF</button></div>
    </div>
    <div id="loansWrap" class="subtle" style="margin-top:8px"></div>
    <div id="loanStatementWrap"></div>
  </section>

  <!-- Ø§Ù„ØªØ¬Ø§Ø± -->
  <section class="card" data-tab="suppliers">
    <h3>Ø§Ù„ØªÙØ¬Ø§Ø±</h3>
    <div class="row">
      <div class="col"><input type="text" id="supName" placeholder="Ø§Ø³Ù… Ø§Ù„ØªØ§Ø¬Ø±"></div>
      <div class="col"><input type="number" id="supInvoice" placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© (ØªØ²ÙŠØ¯ Ø§Ù„Ø¯ÙŠÙ†)"></div>
      <div class="col"><button class="btn btn-ok" id="btnAddInvoice">â• ØªØ³Ø¬ÙŠÙ„ ÙØ§ØªÙˆØ±Ø©</button></div>
    </div>
    <div class="row">
      <div class="col"><input type="text" id="supPayName" list="supList" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ù„Ù„Ø³Ø¯Ø§Ø¯"></div>
      <datalist id="supList"></datalist>
      <div class="col"><input type="number" id="supPayAmount" placeholder="Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© (âˆ’)"></div>
      <div class="col"><select id="supPaySource">
        <option value="store">Ù…Ù† ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„</option>
        <option value="owner">Ù…Ù† ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ</option>
        <option value="bank">Ù…Ù† Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†Ùƒ</option>
      </select></div>
      <div class="col"><button class="btn btn-primary" id="btnPaySupplier">ğŸ’³ ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø©</button></div>
    </div>

    <div class="row print-hide" style="margin-top:8px">
      <div class="col"><input type="text" id="supStmtName" list="supList" placeholder="Ø§Ø³Ù… Ø§Ù„ØªØ§Ø¬Ø± Ù„ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨"></div>
      <div class="col"><input type="date" id="supStmtFrom"></div>
      <div class="col"><input type="date" id="supStmtTo"></div>
      <div class="col"><button class="btn btn-outline" id="btnSupStmt">ğŸ“„ Ø¹Ø±Ø¶ ÙƒØ´Ù Ø§Ù„ØªØ§Ø¬Ø±</button></div>
      <div class="col"><button class="btn btn-outline" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© PDF</button></div>
    </div>

    <div id="supWrap" class="subtle" style="margin-top:8px"></div>
    <div id="supplierStatementWrap"></div>
  </section>

  <!-- Ø§Ù„Ø¯ÙŠÙˆÙ† (Ø¹Ù…Ù„Ø§Ø¡) -->
  <section class="card" data-tab="debts">
    <h3>Ø§Ù„Ø¯ÙŠÙˆÙ† (Ø¹Ù…Ù„Ø§Ø¡)</h3>
    <div class="row">
      <div class="col"><input type="text" id="debtorName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"></div>
      <div class="col"><input type="number" id="debtAmount" placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¯ÙŠÙ† (+)"></div>
      <div class="col"><input type="text" id="debtNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></div>
      <div class="col"><button class="btn btn-ok" id="btnAddDebt">â• ØªØ³Ø¬ÙŠÙ„ Ø¯ÙŠÙ†</button></div>
    </div>
    <div class="row">
      <div class="col"><input type="text" id="debtPayName" list="debtList" placeholder="Ø§Ø®ØªØ±/Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ù„Ù„Ø³Ø¯Ø§Ø¯"></div>
      <datalist id="debtList"></datalist>
      <div class="col"><input type="number" id="debtPayAmount" placeholder="Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯ (âˆ’)"></div>
      <div class="col">
        <select id="debtPayMethod">
          <option value="ÙƒØ§Ø´">ÙƒØ§Ø´ (ÙŠØ²ÙŠØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙƒØ§Ø´)</option>
          <option value="Ø¨Ù†Ùƒ">Ø¨Ù†Ùƒ (ÙŠØ²ÙŠØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ)</option>
        </select>
      </div>
      <div class="col"><button class="btn btn-primary" id="btnPayDebt">ğŸ’° ØªØ³Ø¬ÙŠÙ„ Ø³Ø¯Ø§Ø¯ Ø¯ÙŠÙ†</button></div>
    </div>

    <div class="row print-hide" style="margin-top:8px">
      <div class="col"><input type="text" id="debtStmtName" list="debtList" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨"></div>
      <div class="col"><input type="date" id="debtStmtFrom"></div>
      <div class="col"><input type="date" id="debtStmtTo"></div>
      <div class="col"><button class="btn btn-outline" id="btnDebtStmt">ğŸ“„ Ø¹Ø±Ø¶ ÙƒØ´Ù Ø§Ù„Ø¹Ù…ÙŠÙ„</button></div>
      <div class="col"><button class="btn btn-outline" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© PDF</button></div>
    </div>

    <div id="debtsWrap" class="subtle" style="margin-top:8px"></div>
    <div id="debtStatementWrap"></div>
  </section>

  <!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ -->
  <section class="card" data-tab="owner">
    <h3>ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ</h3>

    <!-- Ø¥ÙŠØ¯Ø§Ø¹/Ø³Ø­Ø¨ Ø¨Ø³ÙŠØ· -->
    <div class="row">
      <div class="col"><input type="number" id="ownerInAmt" placeholder="Ø¥ÙŠØ¯Ø§Ø¹ Ù„Ù„ØµÙ†Ø¯ÙˆÙ‚ (+)"></div>
      <div class="col"><input type="text" id="ownerInNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></div>
      <div class="col"><button class="btn btn-ok" id="btnOwnerDeposit">â• Ø¥ÙŠØ¯Ø§Ø¹</button></div>

      <!-- Ø³Ø­Ø¨ Ù…Ø¹ Ø±Ø¨Ø· (Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯: ØªØ§Ø¬Ø±/Ù…Ø³Ù„Ù) -->
      <div class="col"><input type="number" id="ownerOutAmt" placeholder="Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ (âˆ’)"></div>
      <div class="col">
        <select id="ownerOutBind">
          <option value="">Ø¨Ø¯ÙˆÙ† Ø±Ø¨Ø·</option>
          <option value="supplier">Ø³Ø¯Ø§Ø¯ Ù„ØªØ§Ø¬Ø±</option>
          <option value="loan">Ø³Ø¯Ø§Ø¯ Ù„Ù…Ø³Ù„Ù</option>
        </select>
      </div>
      <div class="col">
        <input type="text" id="ownerOutName" list="ownerBindList" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… (ØªØ§Ø¬Ø±/Ù…Ø³Ù„Ù)">
        <datalist id="ownerBindList"></datalist>
      </div>
      <div class="col"><input type="text" id="ownerOutNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></div>
      <div class="col"><button class="btn btn-danger" id="btnOwnerWithdraw">âˆ’ ØªÙ†ÙÙŠØ° Ø§Ù„Ø³Ø­Ø¨</button></div>
    </div>

    <!-- ØªØ³ÙˆÙŠØ© Ù…Ø¬Ù…Ù‘Ø¹Ø© ØªÙˆØ¶Ø­ ÙƒØ§Ø´/Ø¨Ù†Ùƒ Ù„ÙƒÙ„ Ù…Ø­Ù„ -->
    <div class="subtle" style="margin-top:10px">
      <h4>ØªØ³ÙˆÙŠØ© Ù…Ø¬Ù…Ù‘Ø¹Ø© â€” Ø§Ù„ÙŠÙˆÙ… (ÙƒÙ„ Ø§Ù„Ù…Ø­Ù„Ø§Øª)</h4>
      <div class="row">
        <div class="col"><input type="date" id="aggDay"></div>
        <div class="col"><button class="btn btn-primary" id="btnAggPreview">ğŸ” Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªØ­ØµÙŠÙ„ (ÙƒØ§Ø´/Ø¨Ù†Ùƒ Ù„ÙƒÙ„ Ù…Ø­Ù„)</button></div>
        <div class="col"><button class="btn btn-ok" id="btnAggSettle">âœ… ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ</button></div>
      </div>
      <div id="aggPreviewWrap" class="subtle" style="margin-top:8px"></div>
    </div>

    <!-- ÙƒØ´Ù Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ + Ø·Ø¨Ø§Ø¹Ø© -->
    <div class="subtle" style="margin-top:10px">
      <div class="row print-hide">
        <div class="col"><label>Ù…Ù†</label><input type="date" id="of_from"></div>
        <div class="col"><label>Ø¥Ù„Ù‰</label><input type="date" id="of_to"></div>
        <div class="col"><label>&nbsp;</label><button class="btn btn-primary" id="btnOwnerStmt">Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ´Ù</button></div>
        <div class="col"><label>&nbsp;</label><button class="btn btn-outline" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© PDF</button></div>
      </div>
      <div id="ownerWrap"></div>
    </div>

    <!-- ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ Ù…Ø¬Ù…Ù‘Ø¹ (Ù…Ø¹ ØµØ§ÙÙŠ ÙƒØ§Ø´/Ø¨Ù†Ùƒ) -->
    <div class="subtle" style="margin-top:10px">
      <h4>ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ Ù…Ø¬Ù…Ù‘Ø¹</h4>
      <div class="row print-hide">
        <div class="col"><label>Ø§Ù„Ø´Ù‡Ø±</label><input type="month" id="m_month"></div>
        <div class="col"><label>&nbsp;</label><button class="btn btn-primary" id="btnMonthly">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ</button></div>
        <div class="col"><label>&nbsp;</label><button class="btn btn-outline" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© PDF</button></div>
      </div>
      <div id="monthlyWrap"></div>
    </div>

    <!-- Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ -->
    <div class="subtle print-hide" style="margin-top:10px">
      <h4>Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h4>
      <div class="row">
        <div class="col"><button class="btn btn-outline" id="btnExport">â¬‡ï¸ ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button></div>
        <div class="col">
          <label for="importFile" class="btn btn-ok" style="display:inline-block;cursor:pointer;text-align:center">â¬†ï¸ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù†Ø³Ø®Ø©</label>
          <input id="importFile" type="file" accept="application/json" style="display:none"/>
        </div>
      </div>
      <div class="hint">Ø§Ù„Ù†Ø³Ø®Ø© ØªØ´Ù…Ù„: Ø§Ù„Ù…Ø­Ù„Ø§ØªØŒ Ø§Ù„Ø³Ù„ÙØŒ Ø§Ù„ØªØ¬Ø§Ø±ØŒ Ø§Ù„Ø¯ÙŠÙˆÙ†ØŒ ÙˆØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ.</div>
    </div>
  </section>

</main>

<nav class="tabs print-hide">
  <div class="tab active"><button data-goto="input">Ø¥Ø¯Ø®Ø§Ù„</button></div>
  <div class="tab"><button data-goto="daily">ÙŠÙˆÙ…ÙŠ</button></div>
  <div class="tab"><button data-goto="range">ÙØªØ±Ø©/Ù…Ø¬Ù…Ù‘Ø¹</button></div>
  <div class="tab"><button data-goto="loans">Ø³ÙÙ„Ù</button></div>
  <div class="tab"><button data-goto="suppliers">ØªÙØ¬Ø§Ø±</button></div>
  <div class="tab"><button data-goto="debts">Ø§Ù„Ø¯ÙŠÙˆÙ†</button></div>
  <div class="tab"><button data-goto="owner">Ø§Ù„Ù…Ø§Ù„Ùƒ</button></div>
</nav>

<script>
/* =========================
   Ø§Ù„Ø¬Ø²Ø¡ (1/2): Ø£Ø³Ø§Ø³ÙŠØ§Øª + Ø±Ø¨Ø· Ø¹Ù†Ø§ØµØ± + ØªØ£Ø·ÙŠØ± Ø¹Ø§Ù…
   ========================= */

const stores = { store1:"Ø±ÙˆØ§Ù† Ø¨ÙŠØ¨ÙŠ", store2:"Ø¬Ù†ØªÙ„ Ø¨ÙŠØ¨ÙŠ Ø¹Ø¨ÙˆØ¯", store3:"Ø¨Ø³Ø·Ø©" };
let currentStore = "store1";

/* Ø£Ø¯ÙˆØ§Øª Ù…Ø®ØªØµØ±Ø© */
const qs = (s) => document.querySelector(s);
const qsa = (s) => Array.from(document.querySelectorAll(s));
const todayISO = () => new Date().toISOString().slice(0,10);
const uid = () => Date.now().toString(36)+Math.random().toString(36).slice(2,7);

/* PLACEHOLDER: Ø³ÙŠÙØ³ØªÙƒÙ…Ù„ ÙÙŠ Ø§Ù„Ø¬Ø²Ø¡ (2/2) */
const inRange = (iso,from,to)=>{ if(!iso)return false; const d=new Date(iso+"T00:00:00"); return(!from||d>=new Date(from+"T00:00:00"))&&(!to||d<=new Date(to+"T00:00:00")); };
const sum = (arr,fn)=>arr.reduce((a,b)=>a+fn(b),0);

/* Ù…Ø®Ø§Ø²Ù† (Ø³ÙŠÙÙƒÙ…Ù„ ÙÙŠ Ø§Ù„Ø¬Ø²Ø¡ 2): */
function getStoreData(store=currentStore){ return JSON.parse(localStorage.getItem(store)||'{"sales":[],"expenses":[]}') }
function saveStoreData(data,store=currentStore){ localStorage.setItem(store,JSON.stringify(data)) }
function getLoans(){ return JSON.parse(localStorage.getItem('loans')||'{"people":{}}') }
function saveLoans(v){ localStorage.setItem('loans',JSON.stringify(v)) }
function getSuppliers(){ return JSON.parse(localStorage.getItem('suppliers')||'{"people":{}}') }
function saveSuppliers(v){ localStorage.setItem('suppliers',JSON.stringify(v)) }
function getOwner(){ return JSON.parse(localStorage.getItem('owner_fund')||'{"ledger":[]}') }
function saveOwner(v){ localStorage.setItem('owner_fund',JSON.stringify(v)) }
function getDebts(){ return JSON.parse(localStorage.getItem('debts')||'{"people":{}}') }
function saveDebts(v){ localStorage.setItem('debts',JSON.stringify(v)) }

/* ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ù„Ù„Ø¯ÙÙ„Ø§Ù„Ø§Øª */
function supplierNames(){ const S=getSuppliers(); return S.people?Object.keys(S.people):[] }
function loanNames(){ const L=getLoans(); return L.people?Object.keys(L.people):[] }
function debtorNames(){ const D=getDebts(); return D.people?Object.keys(D.people):[] }
function refreshNameLists(){
  const dl=qs('#benefList'); if(dl){ const names=[...new Set([...supplierNames(),...loanNames()])]; dl.innerHTML=names.map(n=>`<option value="${n}">`).join('') }
  const dl2=qs('#loanList'); if(dl2){ dl2.innerHTML=loanNames().map(n=>`<option value="${n}">`).join('') }
  const dl3=qs('#supList'); if(dl3){ dl3.innerHTML=supplierNames().map(n=>`<option value="${n}">`).join('') }
  const dl4=qs('#debtList'); if(dl4){ dl4.innerHTML=debtorNames().map(n=>`<option value="${n}">`).join('') }
  const dl5=qs('#ownerBindList'); if(dl5){ 
    const names=[...supplierNames().map(n=>'supplier:'+n),...loanNames().map(n=>'loan:'+n)];
    dl5.innerHTML=names.map(n=>`<option value="${n}">`).join('');
  }
}

/* ØªØ¨ÙˆÙŠØ¨Ø§Øª */
function showTab(name){
  qsa('[data-tab]').forEach(el=>el.style.display=(el.getAttribute('data-tab')===name?'block':'none'));
  const order=['input','daily','range','loans','suppliers','debts','owner'];
  qsa('.tabs .tab').forEach((t,i)=>t.classList.toggle('active',order[i]===name));
  if(name==='owner'){ renderOwnerStatement?.(); }
  if(name==='loans'){ renderLoans?.(); }
  if(name==='suppliers'){ renderSuppliers?.(); }
  if(name==='debts'){ renderDebts?.(); }
}
qsa('.tabs button').forEach(
<script>
/* =========================
   Ø§Ù„Ø¬Ø²Ø¡ (2/2): Ù…Ù†Ø·Ù‚ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„
   ========================= */

/* Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© */
const pad2 = (n)=>String(n).padStart(2,'0');
const fmtPretty = (iso)=>{
  if(!iso) return '';
  const d = new Date(iso+"T00:00:00");
  const days = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];
  return `${days[d.getDay()]} ${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
};

/* ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± */
function updateOwnerBalanceUI(){
  const O=getOwner();
  const ins = O.ledger.filter(x=>x.type==='in').reduce((a,b)=>a+Number(b.amount||0),0);
  const outs= O.ledger.filter(x=>x.type==='out').reduce((a,b)=>a+Number(b.amount||0),0);
  const bal = ins - outs;
  const el = qs('#ownerBalanceVal'); if(el) el.textContent = bal;
}

/* Ø±ÙŠÙ†Ø¯Ø± Ø³Ø±ÙŠØ¹ Ù„ÙƒÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */
function renderAll(){
  renderLists();
  renderLoans();
  renderSuppliers();
  renderDebts();
  refreshNameLists();
  updateOwnerBalanceUI();
}

/* ====== Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…ØµØ§Ø±ÙŠÙ ====== */
function addSale(){
  const a = parseFloat(qs('#saleAmount').value||'0');
  const t = qs('#saleType').value;
  const n = (qs('#saleNote').value||'').trim();
  if(!a){ alert('Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­'); return; }
  const d=getStoreData();
  d.sales.push({ id:uid(), date: todayISO(), type: t, amount:a, note:n, meta:{} });
  saveStoreData(d);
  qs('#saleAmount').value=''; qs('#saleNote').value='';
  renderLists();
}

function addExpense(){
  const desc=(qs('#expenseDesc').value||'').trim();
  const a=parseFloat(qs('#expenseAmount').value||'0');
  const note=(qs('#expenseNote').value||'').trim();
  const bType=qs('#expenseBenefType').value||'';
  const bName=(qs('#expenseBenefName').value||'').trim();
  if(!desc||!a){ alert('Ø£Ø¯Ø®Ù„ ÙˆØµÙ ÙˆÙ…Ø¨Ù„Øº ØµØ­ÙŠØ­'); return; }

  const d=getStoreData();
  const exp={ id:uid(), date:todayISO(), type:'ÙƒØ§Ø´', desc, amount:a, note, benefType:bType||null, benefName:bName||null };
  d.expenses.push(exp);
  saveStoreData(d);

  // Ø±Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠ: Ø³Ø¯Ø§Ø¯ ØªØ§Ø¬Ø±/Ù…Ø³Ù„Ù Ù…Ù† ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„
  if(bType && bName){
    if(bType==='supplier'){
      const S=getSuppliers(); if(!S.people) S.people={};
      if(!S.people[bName]) S.people[bName]={balance:0,history:[]};
      S.people[bName].balance -= a;
      S.people[bName].history.push({ id: uid(), date: todayISO(), type:'pay', amount:a, source:'ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„', note:`Ø¯ÙØ¹Ø© (Ù…ØµØ±ÙˆÙ Ù…ÙˆØ¬Ù‘Ù‡)`, linkedExpenseId: exp.id });
      saveSuppliers(S);
    } else if(bType==='loan'){
      const L=getLoans(); if(!L.people) L.people={};
      if(!L.people[bName]) L.people[bName]={balance:0,history:[]};
      L.people[bName].balance -= a;
      L.people[bName].history.push({ id: uid(), date: todayISO(), type:'out', amount:a, source:'ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„', note:`Ø³Ø¯Ø§Ø¯ (Ù…ØµØ±ÙˆÙ Ù…ÙˆØ¬Ù‘Ù‡)`, linkedExpenseId: exp.id });
      saveLoans(L);
    }
  }

  qs('#expenseDesc').value=''; qs('#expenseAmount').value=''; qs('#expenseNote').value='';
  qs('#expenseBenefType').value=''; qs('#expenseBenefName').value='';
  renderLists();
  renderSuppliers();
  renderLoans();
}

function deleteSale(id){
  const d=getStoreData();
  const i = d.sales.findIndex(x=>x.id===id);
  if(i>-1){
    d.sales.splice(i,1);
    saveStoreData(d);
    renderLists();
  }
}
function deleteExpense(id){
  const d=getStoreData();
  const i=d.expenses.findIndex(x=>x.id===id);
  if(i===-1) return;
  const rec=d.expenses[i];
  // Ø¹ÙƒØ³ Ø§Ù„Ø±Ø¨Ø· Ø¥Ù† ÙˆØ¬Ø¯
  if(rec.benefType && rec.benefName){
    if(rec.benefType==='supplier'){
      const S=getSuppliers(); if(S.people && S.people[rec.benefName]){
        S.people[rec.benefName].balance += Number(rec.amount||0);
        S.people[rec.benefName].history.push({ id: uid(), date: todayISO(), type:'revert', amount: rec.amount, note:'Ø¥Ù„ØºØ§Ø¡ Ù…ØµØ±ÙˆÙ Ù…ÙˆØ¬Ù‘Ù‡' });
        saveSuppliers(S);
      }
    }else if(rec.benefType==='loan'){
      const L=getLoans(); if(L.people && L.people[rec.benefName]){
        L.people[rec.benefName].balance += Number(rec.amount||0);
        L.people[rec.benefName].history.push({ id: uid(), date: todayISO(), type:'revert', amount: rec.amount, note:'Ø¥Ù„ØºØ§Ø¡ Ù…ØµØ±ÙˆÙ Ù…ÙˆØ¬Ù‘Ù‡' });
        saveLoans(L);
      }
    }
  }
  d.expenses.splice(i,1);
  saveStoreData(d);
  renderLists();
  renderSuppliers();
  renderLoans();
}

/* Ø¹Ø±Ø¶ Ø¢Ø®Ø± 30 Ø¹Ù…Ù„ÙŠØ© Ù„ÙƒÙ„ Ù‚Ø§Ø¦Ù…Ø© */
function renderLists(){
  const d=getStoreData();
  const rs=d.sales.slice(-30).reverse();
  const re=d.expenses.slice(-30).reverse();

  qs('#recentSales').innerHTML = rs.length? rs.map(v=>`
    <div class="item">
      <div class="meta">${v.date} â€” <span class="badge">${v.type}</span> ${v.note?('â€” <i>'+v.note+'</i>'):''}</div>
      <div><b>${v.amount}</b></div>
      <div><button class="btn btn-danger" onclick="deleteSale('${v.id}')">Ø­Ø°Ù</button></div>
    </div>
  `).join('') : '<div class="hint">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ø¹Ø¯</div>';

  qs('#recentExpenses').innerHTML = re.length? re.map(v=>{
    const link = (v.benefType && v.benefName) ? ` â€” <b>Ù…ÙˆØ¬Ù‘Ù‡: ${v.benefType==='supplier'?'ØªØ§Ø¬Ø±':'Ù…Ø³Ù„Ù'} (${v.benefName})</b>` : '';
    return `
    <div class="item">
      <div class="meta">${v.date} â€” <span class="badge">${v.type}</span> â€” ${v.desc}${link} ${v.note?('â€” <i>'+v.note+'</i>'):''}</div>
      <div><b>${v.amount}</b></div>
      <div><button class="btn btn-danger" onclick="deleteExpense('${v.id}')">Ø­Ø°Ù</button></div>
    </div>`;
  }).join('') : '<div class="hint">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ§Ø±ÙŠÙ Ø¨Ø¹Ø¯</div>';

  refreshNameLists();
}

/* ====== ØªÙ‚Ø§Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠØ© / ÙØªØ±Ø© / Ù…Ø¬Ù…Ù‘Ø¹ ====== */
function calcTotals(entries, typeKey='type'){
  const cs = entries.filter(x=>x[typeKey]==='ÙƒØ§Ø´').reduce((a,b)=>a+Number(b.amount||0),0);
  const bs = entries.filter(x=>x[typeKey]==='Ø¨Ù†Ùƒ').reduce((a,b)=>a+Number(b.amount||0),0);
  return { cs, bs };
}

function generateDaily(){
  const date = qs('#r_date').value || todayISO();
  const store= qs('#r_store').value || currentStore;
  const d=JSON.parse(localStorage.getItem(store)||'{"sales":[],"expenses":[]}');

  const s=d.sales.filter(x=>x.date===date);
  const e=d.expenses.filter(x=>x.date===date);

  const ts=calcTotals(s), te=calcTotals(e);
  const netCash = ts.cs - te.cs;
  const netBank = ts.bs - te.bs;

  const salesRows = s.map(x=>`<tr><td>${x.date}</td><td>${x.type}</td><td>${x.amount}</td><td>${x.note||''}</td></tr>`).join('')||'<tr><td colspan="4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª</td></tr>';
  const expRows   = e.map(x=>`<tr><td>${x.date}</td><td>${x.type}</td><td>${x.desc}</td><td>${x.amount}</td><td>${(x.benefType&&x.benefName)?(x.benefType==='supplier'?'ØªØ§Ø¬Ø±: ':'Ù…Ø³Ù„Ù: ')+x.benefName:(x.note||'')}</td></tr>`).join('')||'<tr><td colspan="5">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØµØ§Ø±ÙŠÙ</td></tr>';

  qs('#dailyWrap').innerHTML = `
    <div class="page">
      <h2 style="margin:0 0 8px">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ â€” ${stores[store]}</h2>
      <div class="hint">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: <b>${fmtPretty(date)}</b> â€” ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: <b>${fmtPretty(todayISO())}</b></div>
      <div class="separator"></div>

      <div class="kpi">
        <div class="box"><b>${ts.cs}</b>Ù…Ø¨ÙŠØ¹Ø§Øª ÙƒØ§Ø´</div>
        <div class="box"><b>${ts.bs}</b>Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ù†Ùƒ</div>
        <div class="box"><b>${te.cs}</b>Ù…ØµØ±ÙˆÙØ§Øª ÙƒØ§Ø´</div>
        <div class="box"><b>${te.bs}</b>Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ùƒ</div>
      </div>

      <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
      <table><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr></thead><tbody>${salesRows}</tbody></table>

      <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h3>
      <table><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ÙˆØµÙ</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª/Ø±Ø¨Ø·</th></tr></thead><tbody>${expRows}</tbody></table>

      <div style="margin-top:16px;display:flex;gap:16px;justify-content:flex-end">
        <div><b>ØµØ§ÙÙŠ Ø§Ù„ÙƒØ§Ø´:</b> ${netCash}</div>
        <div><b>ØµØ§ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ:</b> ${netBank}</div>
        <div><b>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµØ§ÙÙŠ:</b> ${netCash+netBank}</div>
      </div>

      <div style="margin-top:40px;display:flex;justify-content:space-between">
        <div>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø§Ù„Ùƒ: Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø£Ø¨Ùˆ Ø¹ÙˆØ¶ ____________________</div>
        <div>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ: ____________________</div>
      </div>
    </div>`;
}

function generateRange(){
  const from=qs('#f_from').value||todayISO().slice(0,8)+'01';
  const to  =qs('#f_to').value||todayISO();
  const mode=qs('#f_mode').value||'per';
  const shops=Object.keys(stores);

  if(mode==='all'){
    let allSales=[], allExp=[];
    shops.forEach(st=>{
      const d=getStoreData(st);
      allSales=allSales.concat(d.sales.filter(x=>inRange(x.date,from,to)));
      allExp  =allExp.concat(d.expenses.filter(x=>inRange(x.date,from,to)));
    });
    const ts=calcTotals(allSales), te=calcTotals(allExp);
    const netCash = ts.cs - te.cs;
    const netBank = ts.bs - te.bs;
    const net = netCash + netBank;

    qs('#rangeWrap').innerHTML = `
      <div class="page">
        <h2 style="margin:0 0 8px">ØªÙ‚Ø±ÙŠØ± Ù…Ø¬Ù…Ù‘Ø¹ â€” ÙƒÙ„ Ø§Ù„Ù…Ø­Ù„Ø§Øª</h2>
        <div class="hint">Ø§Ù„ÙØªØ±Ø©: <b>${from}</b> â†’ <b>${to}</b> â€” ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: <b>${fmtPretty(todayISO())}</b></div>
        <div class="separator"></div>
        <table>
          <thead><tr><th>Ø§Ù„Ù…Ø¤Ø´Ø±</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr></thead>
          <tbody>
            <tr><td>Ù…Ø¨ÙŠØ¹Ø§Øª ÙƒØ§Ø´</td><td>${ts.cs}</td></tr>
            <tr><td>Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ù†Ùƒ</td><td>${ts.bs}</td></tr>
            <tr><td>Ù…ØµØ±ÙˆÙØ§Øª ÙƒØ§Ø´</td><td>${te.cs}</td></tr>
            <tr><td>Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ùƒ</td><td>${te.bs}</td></tr>
            <tr><td><b>ØµØ§ÙÙŠ Ø§Ù„ÙƒØ§Ø´</b></td><td><b>${netCash}</b></td></tr>
            <tr><td><b>ØµØ§ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ</b></td><td><b>${netBank}</b></td></tr>
            <tr><td><b>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµØ§ÙÙŠ</b></td><td><b>${net}</b></td></tr>
          </tbody>
        </table>

        <div style="margin-top:40px;display:flex;justify-content:space-between">
          <div>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø§Ù„Ùƒ: Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø£Ø¨Ùˆ Ø¹ÙˆØ¶ ____________________</div>
          <div>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ: ____________________</div>
        </div>
      </div>`;
  }else{
    let html='';
    shops.forEach(st=>{
      const d=getStoreData(st);
      const s=d.sales.filter(x=>inRange(x.date,from,to));
      const e=d.expenses.filter(x=>inRange(x.date,from,to));
      const ts=calcTotals(s), te=calcTotals(e);
      const netCash = ts.cs - te.cs;
      const netBank = ts.bs - te.bs;
      html += `
        <div class="page">
          <h2 style="margin:0 0 8px">ØªÙ‚Ø±ÙŠØ± ÙØªØ±Ø© â€” ${stores[st]}</h2>
          <div class="hint">Ø§Ù„ÙØªØ±Ø©: <b>${from}</b> â†’ <b>${to}</b> â€” ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: <b>${fmtPretty(todayISO())}</b></div>
          <div class="separator"></div>
          <table>
            <thead><tr><th>Ø§Ù„Ù…Ø¤Ø´Ø±</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr></thead>
            <tbody>
              <tr><td>Ù…Ø¨ÙŠØ¹Ø§Øª ÙƒØ§Ø´</td><td>${ts.cs}</td></tr>
              <tr><td>Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ù†Ùƒ</td><td>${ts.bs}</td></tr>
              <tr><td>Ù…ØµØ±ÙˆÙØ§Øª ÙƒØ§Ø´</td><td>${te.cs}</td></tr>
              <tr><td>Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ùƒ</td><td>${te.bs}</td></tr>
              <tr><td><b>ØµØ§ÙÙŠ Ø§Ù„ÙƒØ§Ø´</b></td><td><b>${netCash}</b></td></tr>
              <tr><td><b>ØµØ§ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ</b></td><td><b>${netBank}</b></td></tr>
              <tr><td><b>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµØ§ÙÙŠ</b></td><td><b>${netCash+netBank}</b></td></tr>
            </tbody>
          </table>

          <div style="margin-top:40px;display:flex;justify-content:space-between">
            <div>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø§Ù„Ùƒ: Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø£Ø¨Ùˆ Ø¹ÙˆØ¶ ____________________</div>
            <div>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ: ____________________</div>
          </div>
        </div>`;
    });
    qs('#rangeWrap').innerHTML = html;
  }
}

/* ====== ØªØ³ÙˆÙŠØ© Ø§Ù„ÙŠÙˆÙ… ====== */
function settleDaySingleStore(){
  const day = qs('#todayInput').value || todayISO();
  const st = currentStore;
  const d  = getStoreData(st);

  const cashSales = d.sales.filter(x=>x.date===day && x.type==='ÙƒØ§Ø´').reduce((a,b)=>a+Number(b.amount||0),0);
  const bankSales = d.sales.filter(x=>x.date===day && x.type==='Ø¨Ù†Ùƒ').reduce((a,b)=>a+Number(b.amount||0),0);
  const cashExp   = d.expenses.filter(x=>x.date===day && x.type==='ÙƒØ§Ø´').reduce((a,b)=>a+Number(b.amount||0),0);
  const bankExp   = d.expenses.filter(x=>x.date===day && x.type==='Ø¨Ù†Ùƒ').reduce((a,b)=>a+Number(b.amount||0),0);

  const netCash = cashSales - cashExp;
  const netBank = bankSales - bankExp;

  const O=getOwner();
  // Ø§Ø­Ø°Ù Ø£ÙŠ ØªØ³ÙˆÙŠØ§Øª Ø³Ø§Ø¨Ù‚Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…/Ø§Ù„Ù…Ø­Ù„ (Ù…Ù† Ù†ÙˆØ¹ in ÙˆØ¨Ù†Øµ Ù…Ø­Ø¯Ø¯)
  for(let i=O.ledger.length-1;i>=0;i--){
    const e=O.ledger[i];
    if(e.date===day && e.type==='in' && (e.note||'').includes(`ØªØ±Ø­ÙŠÙ„ ${stores[st]}`)){ O.ledger.splice(i,1); }
  }
  // Ø³Ø¬Ù‘Ù„ ÙÙ‚Ø· Ø§Ù„ÙƒØ§Ø´ ÙƒØªØ­ØµÙŠÙ„ (Ø§Ù„Ø¨Ù†Ùƒ Ù„Ø§ ÙŠØ±Ø­Ù‘Ù„ Ù„Ù„ØµÙ†Ø¯ÙˆÙ‚ ÙƒØ§Ø´)
  if(netCash>0){
    O.ledger.push({ id:uid(), date:day, type:'in', amount:+netCash, note:`ØªØ±Ø­ÙŠÙ„ ${stores[st]} â€” Ø§Ù„ÙŠÙˆÙ… ${day} (ÙƒØ§Ø´=${netCash} / Ø¨Ù†Ùƒ=${netBank})` });
  }
  saveOwner(O);
  updateOwnerBalanceUI();
  alert('ØªÙ…Øª ØªØ³ÙˆÙŠØ© Ø§Ù„Ù…Ø­Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ….');
}

/* ØªØ³ÙˆÙŠØ© Ù…Ø¬Ù…Ù‘Ø¹Ø© Ø§Ù„ÙŠÙˆÙ… Ù„ÙƒÙ„ Ø§Ù„Ù…Ø­Ù„Ø§Øª â€” Ù…Ø¹ Ù…Ø¹Ø§ÙŠÙ†Ø© ØªÙØµÙŠÙ„ÙŠØ© */
function previewAggregateDay(){
  const day = qs('#aggDay').value || todayISO();
  const shops = Object.keys(stores);
  let rows='';
  let totalCash=0, totalBank=0;

  shops.forEach(st=>{
    const d=getStoreData(st);
    const cashSales = d.sales.filter(x=>x.date===day && x.type==='ÙƒØ§Ø´').reduce((a,b)=>a+Number(b.amount||0),0);
    const bankSales = d.sales.filter(x=>x.date===day && x.type==='Ø¨Ù†Ùƒ').reduce((a,b)=>a+Number(b.amount||0),0);
    const cashExp   = d.expenses.filter(x=>x.date===day && x.type==='ÙƒØ§Ø´').reduce((a,b)=>a+Number(b.amount||0),0);
    const bankExp   = d.expenses.filter(x=>x.date===day && x.type==='Ø¨Ù†Ùƒ').reduce((a,b)=>a+Number(b.amount||0),0);

    const netCash = cashSales - cashExp;
    const netBank = bankSales - bankExp;

    totalCash += netCash>0?netCash:0;
    totalBank += netBank>0?netBank:0;

    rows += `<tr>
      <td>${stores[st]}</td>
      <td>${cashSales}</td>
      <td>${cashExp}</td>
      <td><b>${netCash}</b></td>
      <td>${bankSales}</td>
      <td>${bankExp}</td>
      <td><b>${netBank}</b></td>
    </tr>`;
  });

  qs('#aggPreviewWrap').innerHTML = `
    <div class="page">
      <h3 style="margin-top:0">Ù…Ø¹Ø§ÙŠÙ†Ø© ØªØ­ØµÙŠÙ„ Ø§Ù„ÙŠÙˆÙ… â€” ${day}</h3>
      <table>
        <thead>
          <tr>
            <th>Ø§Ù„Ù…Ø­Ù„</th>
            <th>Ù…Ø¨ÙŠØ¹Ø§Øª ÙƒØ§Ø´</th><th>Ù…ØµØ±ÙˆÙØ§Øª ÙƒØ§Ø´</th><th>ØµØ§ÙÙŠ ÙƒØ§Ø´</th>
            <th>Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ù†Ùƒ</th><th>Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ùƒ</th><th>ØµØ§ÙÙŠ Ø¨Ù†Ùƒ</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
        <tfoot>
          <tr>
            <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
            <th colspan="2"></th><th>${totalCash}</th>
            <th colspan="2"></th><th>${totalBank}</th>
          </tr>
        </tfoot>
      </table>
      <div class="hint">Ø³ÙŠØªÙ… ØªØ±Ø­ÙŠÙ„ <b>ØµØ§ÙÙŠ Ø§Ù„ÙƒØ§Ø´ ÙÙ‚Ø·</b> Ø¥Ù„Ù‰ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ. ØµØ§ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ Ù„Ù„Ø¹Ø±Ø¶.</div>
    </div>`;
}

function settleDayAllStores(){
  const day = qs('#todayInput').value || todayISO();
  const shops = Object.keys(stores);
  let totalCashToOwner=0;
  let noteParts=[];

  shops.forEach(st=>{
    const d=getStoreData(st);
    const cashSales = d.sales.filter(x=>x.date===day && x.type==='ÙƒØ§Ø´').reduce((a,b)=>a+Number(b.amount||0),0);
    const bankSales = d.sales.filter(x=>x.date===day && x.type==='Ø¨Ù†Ùƒ').reduce((a,b)=>a+Number(b.amount||0),0);
    const cashExp   = d.expenses.filter(x=>x.date===day && x.type==='ÙƒØ§Ø´').reduce((a,b)=>a+Number(b.amount||0),0);
    const bankExp   = d.expenses.filter(x=>x.date===day && x.type==='Ø¨Ù†Ùƒ').reduce((a,b)=>a+Number(b.amount||0),0);
    const netCash = cashSales - cashExp;
    const netBank = bankSales - bankExp;

    if(netCash>0){ totalCashToOwner += netCash; }
    noteParts.push(`${stores[st]}: ÙƒØ§Ø´=${netCash} / Ø¨Ù†Ùƒ=${netBank}`);
  });

  const O=getOwner();
  // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ ØªØ±Ø­ÙŠÙ„ Ø¬Ù…Ø§Ø¹ÙŠ Ø³Ø§Ø¨Ù‚ Ù„Ù„ÙŠÙˆÙ… Ù†ÙØ³Ù‡
  for(let i=O.ledger.length-1;i>=0;i--){
    const e=O.ledger[i];
    if(e.date===day && e.type==='in' && (e.note||'').startsWith('ØªØ±Ø­ÙŠÙ„ Ù…Ø¬Ù…Ù‘Ø¹ Ù„Ù„Ù…Ø­Ù„Ø§Øª')){
      O.ledger.splice(i,1);
    }
  }
  if(totalCashToOwner>0){
    O.ledger.push({
      id: uid(),
      date: day,
      type: 'in',
      amount: +totalCashToOwner,
      note: `ØªØ±Ø­ÙŠÙ„ Ù…Ø¬Ù…Ù‘Ø¹ Ù„Ù„Ù…Ø­Ù„Ø§Øª â€” ${noteParts.join(' | ')}`
    });
    saveOwner(O);
    updateOwnerBalanceUI();
    alert(`ØªÙ… ØªØ±Ø­ÙŠÙ„ ÙƒØ§Ø´ Ø¥Ø¬Ù…Ø§Ù„ÙŠ = ${totalCashToOwner} Ø¥Ù„Ù‰ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ.`);
  }else{
    alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒØ§Ø´ ÙØ§Ø¦Ø¶ Ù„Ù„ØªØ±Ø­ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ….');
  }
}

/* ====== Ø§Ù„Ø³ÙÙ„Ù (ØªØ²ÙŠØ¯ ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„ ÙˆØªØ¸Ù‡Ø± ÙƒÙ…Ù„Ø§Ø­Ø¸Ø©) ====== */
function renderLoans(){
  const L=getLoans(), names=Object.keys(L.people||{});
  if(!names.length){ qs('#loansWrap').innerHTML='<div class="hint">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ù„Ù Ø¨Ø¹Ø¯</div>'; refreshNameLists(); return; }
  const rows = names.map(n=>`<tr><td>${n}</td><td>${L.people[n].balance||0}</td>
    <td><button class="btn btn-danger" onclick="deleteLoanPerson('${n.replace(/'/g,"\\'")}')">ğŸ—‘ Ø­Ø°Ù</button></td></tr>`).join('');
  qs('#loansWrap').innerHTML = `
    <table><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead><tbody>${rows}</tbody></table>`;
  refreshNameLists();
}
function addLoan(){
  const name=(qs('#loanPerson').value||'').trim();
  const amt =parseFloat(qs('#loanAmount').value||'0');
  if(!name||!amt){ alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ÙˆÙ…Ø¨Ù„Øº ØµØ­ÙŠØ­'); return; }
  const L=getLoans(); if(!L.people) L.people={};
  if(!L.people[name]) L.people[name]={balance:0,history:[]};
  const id=uid(); L.people[name].balance += amt;
  L.people[name].history.push({ id, date: todayISO(), type:'in', amount: amt, note:'Ø³Ù„ÙØ© Ù„Ù„Ù…Ø­Ù„' });
  saveLoans(L);

  // Ø²ÙŠØ§Ø¯Ø© ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„ ÙƒÙ‚ÙŠØ¯ "ØºÙŠØ± Ù…Ø¨ÙŠØ¹Ø§Øª" ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
  const d=getStoreData();
  d.sales.push({ id: uid(), date: todayISO(), type:'ÙƒØ§Ø´', amount: amt, note:`Ø³Ù„ÙØ© Ù…Ù† ${name} (ØºÙŠØ± Ù…Ø¨ÙŠØ¹Ø§Øª)`, meta:{kind:'loanIn', lender:name} });
  saveStoreData(d);

  qs('#loanPerson').value=''; qs('#loanAmount').value='';
  renderLoans(); renderLists();
}
function payLoan(){
  const name=(qs('#loanPayPerson').value||'').trim();
  const amt =parseFloat(qs('#loanPayAmount').value||'0');
  const src =qs('#loanPaySource').value;
  if(!name||!amt){ alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ÙˆÙ…Ø¨Ù„Øº ØµØ­ÙŠØ­'); return; }
  const L=getLoans(); if(!L.people || !L.people[name]){ alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³Ù„Ù'); return; }

  const payId=uid(); let linkedExpenseId=null;
  L.people[name].balance -= amt;
  L.people[name].history.push({ id: payId, date: todayISO(), type:'out', amount: amt, source:(src==='store'?'ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„':'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ'), note:`Ø³Ø¯Ø§Ø¯ Ù…Ù† ${src==='store'?'ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„':'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ'}`, linkedExpenseId:null });
  saveLoans(L);

  if(src==='store'){
    const d=getStoreData(); linkedExpenseId=uid();
    d.expenses.push({ id: linkedExpenseId, date: todayISO(), type:'ÙƒØ§Ø´', desc:`Ø³Ø¯Ø§Ø¯ Ø³Ù„ÙØ© (${name})`, amount: amt, note:'Ù…Ù† ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„', benefType:'loan', benefName:name });
    saveStoreData(d);
    const L2=getLoans(); const rec=(L2.people[name].history||[]).find(x=>x.id===payId);
    if(rec){ rec.linkedExpenseId=linkedExpenseId; saveLoans(L2); }
    renderLists();
  }else{
    const O=getOwner(); O.ledger.push({ id: uid(), date: todayISO(), type:'out', amount: amt, note:`Ø³Ø¯Ø§Ø¯ Ø³Ù„ÙØ© (${name})` }); saveOwner(O); updateOwnerBalanceUI();
  }

  qs('#loanPayPerson').value=''; qs('#loanPayAmount').value='';
  renderLoans(); renderOwnerStatement();
}
function deleteLoanPerson(name){
  if(!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø³Ù„Ù "${name}" ÙˆØ¬Ù…ÙŠØ¹ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙ‡ØŸ`)) return;
  const L=getLoans(); if(L.people && L.people[name]){ delete L.people[name]; saveLoans(L); renderLoans(); refreshNameLists(); alert('ØªÙ… Ø§Ù„Ø­Ø°Ù'); }
}

/* ÙƒØ´Ù Ù„Ù…Ø³Ù„Ù Ù…Ø­Ø¯Ø¯ */
function renderLoanStatement(){
  const name=(qs('#loanStmtName').value||'').trim();
  const from=qs('#loanStmtFrom').value||todayISO().slice(0,8)+'01';
  const to  =qs('#loanStmtTo').value||todayISO();
  const L=getLoans(); if(!name || !L.people || !L.people[name]){ qs('#loanStatementWrap').innerHTML='<div class="hint">Ø§Ø®ØªØ± Ø§Ø³Ù…Ù‹Ø§ ØµØ­ÙŠØ­Ù‹Ø§</div>'; return; }
  const hist=(L.people[name].history||[]).filter(h=>inRange(h.date,from,to));
  const rows = hist.length? hist.map(h=>`<tr><td>${h.date}</td><td>${h.type==='in'?'Ø³Ù„ÙØ© (+)':'Ø³Ø¯Ø§Ø¯ (âˆ’)'}</td><td>${h.amount}</td><td>${h.note||''}</td></tr>`).join('') : `<tr><td colspan="4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª</td></tr>`;
  const bal=L.people[name].balance||0;
  qs('#loanStatementWrap').innerHTML = `
    <div class="page">
      <h3 style="margin:0 0 8px">ÙƒØ´Ù Ø­Ø³Ø§Ø¨ â€” Ù…Ø³Ù„Ù: ${name}</h3>
      <div class="hint">Ø§Ù„ÙØªØ±Ø©: ${from} â†’ ${to}</div>
      <table><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ù…Ù„Ø§Ø­Ø¸Ø©</th></tr></thead><tbody>${rows}</tbody></table>
      <div style="margin-top:8px"><b>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ:</b> ${bal}</div>
    </div>`;
}

/* ====== Ø§Ù„ØªØ¬Ø§Ø± ====== */
function renderSuppliers(){
  const S=getSuppliers(), names=Object.keys(S.people||{});
  if(!names.length){ qs('#supWrap').innerHTML='<div class="hint">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ¬Ø§Ø± Ø¨Ø¹Ø¯</div>'; refreshNameLists(); return; }
  const rows = names.map(n=>`<tr><td>${n}</td><td>${S.people[n].balance||0}</td>
    <td><button class="btn btn-danger" onclick="deleteSupplierPerson('${n.replace(/'/g,"\\'")}')">ğŸ—‘ Ø­Ø°Ù</button></td></tr>`).join('');
  qs('#supWrap').innerHTML = `<table><thead><tr><th>Ø§Ù„ØªØ§Ø¬Ø±</th><th>Ø§Ù„Ø±ØµÙŠØ¯ (Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©)</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead><tbody>${rows}</tbody></table>`;
  refreshNameLists();
}
function addSupplierInvoice(){
  const name=(qs('#supName').value||'').trim();
  const amt =parseFloat(qs('#supInvoice').value||'0');
  if(!name||!amt){ alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ÙˆÙ‚ÙŠÙ…Ø© ÙØ§ØªÙˆØ±Ø©'); return; }
  const S=getSuppliers(); if(!S.people) S.people={}; if(!S.people[name]) S.people[name]={balance:0,history:[]};
  const id=uid(); S.people[name].balance += amt;
  S.people[name].history.push({ id, date: todayISO(), type:'invoice', amount: amt, note:'ÙØ§ØªÙˆØ±Ø© Ù…Ø´ØªØ±ÙŠØ§Øª' });
  saveSuppliers(S);
  qs('#supName').value=''; qs('#supInvoice').value='';
  renderSuppliers();
}
function paySupplier(){
  const name=(qs('#supPayName').value||'').trim();
  const amt =parseFloat(qs('#supPayAmount').value||'0');
  const src =qs('#supPaySource').value;
  if(!name||!amt){ alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ÙˆÙ…Ø¨Ù„Øº ØµØ­ÙŠØ­'); return; }
  const S=getSuppliers(); if(!S.people || !S.people[name]){ alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø¬Ø±'); return; }
  const payId=uid(); let linkedExpenseId=null;

  S.people[name].balance -= amt;
  S.people[name].history = S.people[name].history||[];
  S.people[name].history.push({ id: payId, date: todayISO(), type:'pay', amount: amt, source:(src==='store'?'ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„':(src==='owner'?'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ':'Ø§Ù„Ø¨Ù†Ùƒ')), note:`Ø¯ÙØ¹Ø© Ù…Ù† ${src==='store'?'ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„':(src==='owner'?'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ':'Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†Ùƒ')}`, linkedExpenseId:null });
  saveSuppliers(S);

  if(src==='store'){
    const d=getStoreData(); linkedExpenseId=uid();
    d.expenses.push({ id: linkedExpenseId, date: todayISO(), type:'ÙƒØ§Ø´', desc:`Ø¯ÙØ¹Ø© ØªØ§Ø¬Ø± (${name})`, amount: amt, note:'Ù…Ù† ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„', benefType:'supplier', benefName:name });
    saveStoreData(d);
    const S2=getSuppliers(); const rec=(S2.people[name].history||[]).find(x=>x.id===payId);
    if(rec){ rec.linkedExpenseId=linkedExpenseId; saveSuppliers(S2); }
    renderLists();
  }else if(src==='owner'){
    const O=getOwner(); O.ledger.push({ id: uid(), date: todayISO(), type:'out', amount: amt, note:`Ø¯ÙØ¹Ø© ØªØ§Ø¬Ø± (${name})` }); saveOwner(O); updateOwnerBalanceUI();
  }else{
    const d=getStoreData(); linkedExpenseId=uid();
    d.expenses.push({ id: linkedExpenseId, date: todayISO(), type:'Ø¨Ù†Ùƒ', desc:`Ø¯ÙØ¹Ø© ØªØ§Ø¬Ø± (${name})`, amount: amt, note:'Ù…Ù† Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†Ùƒ', benefType:'supplier', benefName:name });
    saveStoreData(d);
    const S3=getSuppliers(); const rec=(S3.people[name].history||[]).find(x=>x.id===payId);
    if(rec){ rec.linkedExpenseId=linkedExpenseId; saveSuppliers(S3); }
    renderLists();
  }

  qs('#supPayName').value=''; qs('#supPayAmount').value='';
  renderSuppliers(); renderOwnerStatement();
}
function deleteSupplierPerson(name){
  if(!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ØªØ§Ø¬Ø± "${name}" ÙˆØ¬Ù…ÙŠØ¹ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙ‡ØŸ`)) return;
  const S=getSuppliers(); if(S.people && S.people[name]){ delete S.people[name]; saveSuppliers(S); renderSuppliers(); refreshNameLists(); alert('ØªÙ… Ø§Ù„Ø­Ø°Ù'); }
}

/* ÙƒØ´Ù Ù„ØªØ§Ø¬Ø± Ù…Ø­Ø¯Ø¯ */
function renderSupplierStatement(){
  const name=(qs('#supStmtName').value||'').trim();
  const from=qs('#supStmtFrom').value||todayISO().slice(0,8)+'01';
  const to  =qs('#supStmtTo').value||todayISO();
  const S=getSuppliers(); if(!name || !S.people || !S.people[name]){ qs('#supplierStatementWrap').innerHTML='<div class="hint">Ø§Ø®ØªØ± Ø§Ø³Ù… ØªØ§Ø¬Ø± ØµØ­ÙŠØ­</div>'; return; }
  const hist=(S.people[name].history||[]).filter(h=>inRange(h.date,from,to));
  const rows = hist.length? hist.map(h=>`<tr><td>${h.date}</td><td>${h.type==='invoice'?'ÙØ§ØªÙˆØ±Ø© (+)':'Ø¯ÙØ¹Ø© (âˆ’)'}</td><td>${h.amount}</td><td>${h.note||''}</td></tr>`).join('') : `<tr><td colspan="4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª</td></tr>`;
  const bal=S.people[name].balance||0;
  qs('#supplierStatementWrap').innerHTML = `
    <div class="page">
      <h3 style="margin:0 0 8px">ÙƒØ´Ù Ø­Ø³Ø§Ø¨ â€” ØªØ§Ø¬Ø±: ${name}</h3>
      <div class="hint">Ø§Ù„ÙØªØ±Ø©: ${from} â†’ ${to}</div>
      <table><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ù…Ù„Ø§Ø­Ø¸Ø©</th></tr></thead><tbody>${rows}</tbody></table>
      <div style="margin-top:8px"><b>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©):</b> ${bal}</div>
    </div>`;
}

/* ====== Ø§Ù„Ø¯ÙŠÙˆÙ† (Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡) ====== */
function renderDebts(){
  const D=getDebts(), names=Object.keys(D.people||{});
  if(!names.length){ qs('#debtsWrap').innerHTML='<div class="hint">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙŠÙˆÙ† Ø¨Ø¹Ø¯</div>'; refreshNameLists(); return; }
  const rows = names.map(n=>`<tr><td>${n}</td><td>${D.people[n].balance||0}</td>
    <td><button class="btn btn-danger" onclick="deleteDebtor('${n.replace(/\'/g,"\\'")}')">ğŸ—‘ Ø­Ø°Ù</button></td></tr>`).join('');
  qs('#debtsWrap').innerHTML = `<table><thead><tr><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead><tbody>${rows}</tbody></table>`;
  refreshNameLists();
}
function addDebt(){
  const name=(qs('#debtorName').value||'').trim();
  const amt =parseFloat(qs('#debtAmount').value||'0');
  const note=(qs('#debtNote').value||'').trim();
  if(!name||!amt){ alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ÙˆÙ‚ÙŠÙ…Ø© Ø¯ÙŠÙ†'); return; }
  const D=getDebts(); if(!D.people) D.people={};
  if(!D.people[name]) D.people[name]={balance:0,history:[]};
  D.people[name].balance += amt;
  D.people[name].history.push({ id: uid(), date: todayISO(), type:'debt', amount: amt, note: note||'Ø¯ÙŠÙ† Ù…Ø¨ÙŠØ¹Ø§Øª' });
  saveDebts(D);
  qs('#debtorName').value=''; qs('#debtAmount').value=''; qs('#debtNote').value='';
  renderDebts();
}
function payDebt(){
  const name=(qs('#debtPayName').value||'').trim();
  const amt =parseFloat(qs('#debtPayAmount').value||'0');
  const method = qs('#debtPayMethod').value; // "ÙƒØ§Ø´" Ø£Ùˆ "Ø¨Ù†Ùƒ"
  if(!name||!amt){ alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ÙˆÙ…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯'); return; }
  const D=getDebts(); if(!D.people || !D.people[name]){ alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„'); return; }

  D.people[name].balance -= amt;
  D.people[name].history.push({ id: uid(), date: todayISO(), type:'pay', amount: amt, note:`Ø³Ø¯Ø§Ø¯ Ø¯ÙŠÙ† (${method})` });
  saveDebts(D);

  // ÙŠØ²ÙŠØ¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ… ÙƒØ§Ø´/Ø¨Ù†Ùƒ Ø­Ø³Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯
  const d=getStoreData();
  d.sales.push({ id: uid(), date: todayISO(), type: method, amount: amt, note:`ØªØ­ØµÙŠÙ„ Ø¯ÙŠÙ† Ù…Ù† ${name}` , meta:{kind:'debtCollection'}});
  saveStoreData(d);

  qs('#debtPayName').value=''; qs('#debtPayAmount').value='';
  renderDebts(); renderLists();
}
function deleteDebtor(name){
  if(!confirm(`Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ "${name}" ÙˆÙƒÙ„ Ø³Ø¬Ù„Ø§ØªÙ‡ØŸ`)) return;
  const D=getDebts(); if(D.people && D.people[name]){ delete D.people[name]; saveDebts(D); renderDebts(); refreshNameLists(); alert('ØªÙ… Ø§Ù„Ø­Ø°Ù'); }
}

/* ====== ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ: Ø¥ÙŠØ¯Ø§Ø¹/Ø³Ø­Ø¨/ÙƒØ´Ù/Ø´Ù‡Ø±ÙŠ ====== */
function ownerDeposit(){
  const amt=parseFloat(qs('#ownerInAmt').value||'0');
  const note=(qs('#ownerInNote').value||'').trim();
  if(!amt){ alert('Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø¥ÙŠØ¯Ø§Ø¹'); return; }
  const O=getOwner(); O.ledger.push({ id: uid(), date: todayISO(), type:'in', amount: amt, note: note||'Ø¥ÙŠØ¯Ø§Ø¹ ÙŠØ¯ÙˆÙŠ' });
  saveOwner(O); updateOwnerBalanceUI();
  qs('#ownerInAmt').value=''; qs('#ownerInNote').value='';
  renderOwnerStatement();
}

/* Ø³Ø­Ø¨ Ù…Ø¹ Ø±Ø¨Ø· ØªØ§Ø¬Ø±/Ù…Ø³Ù„Ù â€” ÙŠØ®ØµÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø­Ø³Ø§Ø¨Ù‡Ù… */
function ownerWithdrawBound(){
  const amt=parseFloat(qs('#ownerOutAmt').value||'0');
  const bind=qs('#ownerOutBind').value; // '', 'supplier', 'loan'
  const who =(qs('#ownerOutName').value||'').trim();
  const note=(qs('#ownerOutNote').value||'').trim();
  if(!amt){ alert('Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ø­Ø¨'); return; }

  // Ù‚ÙŠØ¯ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
  const O=getOwner(); O.ledger.push({ id: uid(), date: todayISO(), type:'out', amount: amt, note: note || (bind?(`Ø³Ø­Ø¨ â€” Ø³Ø¯Ø§Ø¯ ${bind==='supplier'?'ØªØ§Ø¬Ø±':'Ù…Ø³Ù„Ù'} (${who})`):'Ø³Ø­Ø¨') });
  saveOwner(O); updateOwnerBalanceUI();

  // Ø§Ù„Ø±Ø¨Ø·
  if(bind && who){
    if(bind==='supplier'){
      const S=getSuppliers(); if(!S.people) S.people={};
      if(!S.people[who]) S.people[who]={balance:0,history:[]};
      S.people[who].balance -= amt;
      S.people[who].history.push({ id: uid(), date: todayISO(), type:'pay', amount: amt, source:'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ', note:'Ø¯ÙØ¹Ø© (Ù…Ù† ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ)' });
      saveSuppliers(S);
      renderSuppliers();
    }else if(bind==='loan'){
      const L=getLoans(); if(!L.people) L.people={};
      if(!L.people[who]) L.people[who]={balance:0,history:[]};
      L.people[who].balance -= amt;
      L.people[who].history.push({ id: uid(), date: todayISO(), type:'out', amount: amt, source:'ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ', note:'Ø³Ø¯Ø§Ø¯ (Ù…Ù† ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ)' });
      saveLoans(L);
      renderLoans();
    }
  }

  qs('#ownerOutAmt').value=''; qs('#ownerOutNote').value=''; qs('#ownerOutBind').value=''; qs('#ownerOutName').value='';
  renderOwnerStatement();
}

/* ÙƒØ´Ù ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ (Ù…Ø¹ ØªÙˆØ¶ÙŠØ­ ÙƒØ§Ø´/Ø¨Ù†Ùƒ Ù„ÙƒÙ„ Ù…Ø­Ù„ ÙÙŠ Ø§Ù„ØªØ³ÙˆÙŠØ§Øª Ø§Ù„Ù…Ø¬Ù…Ù‘Ø¹Ø© Ø¶Ù…Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©) */
function renderOwnerStatement(){
  const from=(qs('#of_from').value||todayISO().slice(0,8)+'01');
  const to  =(qs('#of_to').value||todayISO());
  const O=getOwner(); const rows=O.ledger.filter(x=>inRange(x.date,from,to));
  const ins=sum(rows,x=>x.type==='in'?Number(x.amount||0):0);
  const outs=sum(rows,x=>x.type==='out'?Number(x.amount||0):0);
  const tbl=rows.length?rows.map(e=>`<tr><td>${e.date}</td><td>${e.type==='in'?'ØªØ­ØµÙŠÙ„':'ØµØ±Ù'}</td><td>${e.amount}</td><td>${e.note||''}</td></tr>`).join(''):`<tr><td colspan="4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª</td></tr>`;
  qs('#ownerWrap').innerHTML = `
    <div class="page">
      <h2 style="margin:0 0 8px">ÙƒØ´Ù ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ</h2>
      <div class="hint">Ø§Ù„ÙØªØ±Ø©: <b>${from}</b> â†’ <b>${to}</b> â€” ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: <b>${todayISO()}</b></div>
      <div class="separator"></div>
      <table><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</th></tr></thead><tbody>${tbl}</tbody></table>
      <div style="margin-top:8px"><b>ØªØ­ØµÙŠÙ„:</b> ${ins} â€” <b>ØµØ±Ù:</b> ${outs} â€” <b>Ø§Ù„Ø±ØµÙŠØ¯:</b> ${ins-outs}</div>
      <div style="margin-top:40px;display:flex;justify-content:space-between">
        <div>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø§Ù„Ùƒ: Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø£Ø¨Ùˆ Ø¹ÙˆØ¶ ____________________</div>
        <div>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ: ____________________</div>
      </div>
    </div>`;
  updateOwnerBalanceUI();
}

/* ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ Ù…Ø¬Ù…Ù‘Ø¹ Ù…Ø¹ ØµØ§ÙÙŠ ÙƒØ§Ø´/Ø¨Ù†Ùƒ */
function generateMonthly(){
  const ym=(qs('#m_month').value||todayISO().slice(0,7));
  let allSales=[], allExp=[];
  Object.keys(stores).forEach(st=>{
    const d=getStoreData(st);
    allSales=allSales.concat(d.sales.filter(x=>x.date.slice(0,7)===ym));
    allExp  =allExp.concat(d.expenses.filter(x=>x.date.slice(0,7)===ym));
  });
  const ts=calcTotals(allSales), te=calcTotals(allExp);
  const netCash = ts.cs - te.cs;
  const netBank = ts.bs - te.bs;

  const O=getOwner(); const rows=O.ledger.filter(x=>x.date.slice(0,7)===ym);
  const ins=sum(rows,x=>x.type==='in'?Number(x.amount||0):0);
  const outs=sum(rows,x=>x.type==='out'?Number(x.amount||0):0);

  qs('#monthlyWrap').innerHTML=`
    <div class="page">
      <h2 style="margin:0 0 8px">ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ Ù…Ø¬Ù…Ù‘Ø¹ â€” ${ym}</h2>
      <div class="hint">ÙŠØ´Ù…Ù„ ÙƒÙ„ Ø§Ù„Ù…Ø­Ù„Ø§Øª + ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ â€” ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: <b>${todayISO()}</b></div>
      <div class="separator"></div>
      <table>
        <thead><tr><th>Ø§Ù„Ù…Ø¤Ø´Ø±</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr></thead>
        <tbody>
          <tr><td>Ù…Ø¨ÙŠØ¹Ø§Øª ÙƒØ§Ø´</td><td>${ts.cs}</td></tr>
          <tr><td>Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ù†Ùƒ</td><td>${ts.bs}</td></tr>
          <tr><td>Ù…ØµØ±ÙˆÙØ§Øª ÙƒØ§Ø´</td><td>${te.cs}</td></tr>
          <tr><td>Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ùƒ</td><td>${te.bs}</td></tr>
          <tr><td><b>ØµØ§ÙÙŠ Ø§Ù„ÙƒØ§Ø´</b></td><td><b>${netCash}</b></td></tr>
          <tr><td><b>ØµØ§ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ</b></td><td><b>${netBank}</b></td></tr>
          <tr><td><b>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµØ§ÙÙŠ</b></td><td><b>${netCash+netBank}</b></td></tr>
          <tr><td>ØªØ­ØµÙŠÙ„Ø§Øª ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ</td><td>${ins}</td></tr>
          <tr><td>Ù…ØµØ±ÙˆÙØ§Øª ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ</td><td>${outs}</td></tr>
          <tr><td><b>Ø±ØµÙŠØ¯ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ù„Ùƒ Ø®Ù„Ø§Ù„ Ø§Ù„Ø´Ù‡Ø±</b></td><td><b>${ins-outs}</b></td></tr>
        </tbody>
      </table>
      <div style="margin-top:40px;display:flex;justify-content:space-between">
        <div>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø§Ù„Ùƒ: Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø£Ø¨Ùˆ Ø¹ÙˆØ¶ ____________________</div>
        <div>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ: ____________________</div>
      </div>
    </div>`;
}

/* ====== ØªØµØ¯ÙŠØ±/Ø§Ø³ØªÙŠØ±Ø§Ø¯ ====== */
function exportBackup(){
  const payload={
    version:"final-owner-aggregate-v1",
    at:new Date().toISOString(),
    stores:{
      store1:JSON.parse(localStorage.getItem('store1')||'{"sales":[],"expenses":[]}'),
      store2:JSON.parse(localStorage.getItem('store2')||'{"sales":[],"expenses":[]}'),
      store3:JSON.parse(localStorage.getItem('store3')||'{"sales":[],"expenses":[]}'),
    },
    loans:getLoans(), suppliers:getSuppliers(), debts:getDebts(), owner_fund:getOwner()
  };
  const blob=new Blob([JSON.stringify(payload,null,2)],{type:"application/json"});
  const a=document.createElement("a"); const ts=new Date();
  a.href=URL.createObjectURL(blob);
  a.download=`backup-${ts.getFullYear()}${pad2(ts.getMonth()+1)}${pad2(ts.getDate())}-${pad2(ts.getHours())}${pad2(ts.getMinutes())}.json`;
  document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(a.href),1000);
}
function importBackup(file){
  if(!file){ alert("Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©"); return; }
  const r=new FileReader();
  r.onload=e=>{
    try{
      const data=JSON.parse(e.target.result);
      if(!data||!data.stores) throw new Error("Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­");
      localStorage.setItem('store1',JSON.stringify(data.stores.store1||{"sales":[],"expenses":[]}));
      localStorage.setItem('store2',JSON.stringify(data.stores.store2||{"sales":[],"expenses":[]}));
      localStorage.setItem('store3',JSON.stringify(data.stores.store3||{"sales":[],"expenses":[]}));
      localStorage.setItem('owner_fund',JSON.stringify(data.owner_fund||{"ledger":[]}));
      localStorage.setItem('loans',JSON.stringify(data.loans||{"people":{}}));
      localStorage.setItem('suppliers',JSON.stringify(data.suppliers||{"people":{}}));
      localStorage.setItem('debts',JSON.stringify(data.debts||{"people":{}}));
      renderAll(); renderOwnerStatement();
    }catch(err){ alert("ØªØ¹Ø°Ø± Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: "+err.message); }
  };
  r.readAsText(file);
}

/* Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ (2/2) */
</script>  
